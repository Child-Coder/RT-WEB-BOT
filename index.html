<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBL Mini App Dashboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* TBL Theme Integration and Basic Styles */
        body { 
            background: var(--tg-theme-bg-color, #ffffff); 
            color: var(--tg-theme-text-color, #000000); 
            font-family: Arial, sans-serif; 
            padding: 10px;
        }
        .container { max-width: 800px; margin: auto; }
        .panel { 
            background: var(--tg-theme-secondary-bg-color, #f0f0f0); 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); 
        }
        .nav-button {
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .nav-button.active {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }
        .view { display: none; }
        .stat-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dotted var(--tg-theme-hint-color); }
        .stat-value { font-weight: bold; color: var(--tg-theme-button-color); }
        .withdraw-form input, .withdraw-form select {
            width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px;
            border: 1px solid var(--tg-theme-hint-color); background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color); box-sizing: border-box;
        }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .admin-table th, .admin-table td { border: 1px solid var(--tg-theme-hint-color); padding: 8px; text-align: left; font-size: 0.85em; }
        .admin-table th { background-color: var(--tg-theme-secondary-bg-color); }
        .loading { text-align: center; padding: 20px; }
        .alert { padding: 10px; border-radius: 5px; margin-bottom: 10px; }
        .alert.success { background-color: #d4edda; color: #155724; }
        .alert.error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="container">
    <div id="status-message" class="alert" style="display: none;"></div>
    <div id="loading" class="loading">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>

    <div id="nav-bar" style="text-align: center; margin-bottom: 15px; display: none;">
        <button class="nav-button active" onclick="showView('account')">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</button>
        <button class="nav-button" onclick="showView('tasks')">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</button>
        <button class="nav-button" onclick="showView('withdraw')">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
        <button class="nav-button" onclick="showView('leaderboard')">‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
        <button class="nav-button" onclick="showView('support')">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
        <button class="nav-button" id="admin-nav-btn" style="display: none;" onclick="showView('admin')">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</button>
    </div>

    <div id="account" class="view panel">
        <h2>üë§ ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h2>
        <div class="stat-item"><span>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø:</span> <span id="acc-user-id" class="stat-value"></span></div>
        <div class="stat-item"><span>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (‡¶ï‡ßü‡ßá‡¶®):</span> <span id="acc-coins" class="stat-value"></span></div>
        <div class="stat-item"><span>‡¶Æ‡ßã‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤:</span> <span id="acc-referrals" class="stat-value"></span></div>
        <div class="stat-item"><span>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï:</span> <code id="acc-ref-link" style="word-break: break-all;"></code></div>
    </div>

    <div id="tasks" class="view panel">
        <h2>üìù ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
        <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶™‡¶æ‡¶¨‡ßá‡¶®:</p>
        
        <div class="stat-item">
            <span>‡ßß. ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</span>
            <span id="task1-status" class="stat-value"></span>
            <button id="task1-btn" onclick="submitTask('1')" class="nav-button" style="margin: 0; padding: 5px 10px;">‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</button>
        </div>
        
        <div class="stat-item">
            <span>‡ß®. ‡ß© ‡¶ú‡¶® ‡¶∏‡¶´‡¶≤ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ü‡¶®‡ßÅ‡¶®</span>
            <span id="task2-status" class="stat-value"></span>
            <button id="task2-btn" onclick="submitTask('2')" class="nav-button" style="margin: 0; padding: 5px 10px;">‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®</button>
        </div>
        
        <p style="margin-top: 15px;">** ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡ß® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡•§</p>
    </div>

    <div id="withdraw" class="view panel">
        <h2>üí∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤</h2>
        <p>‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤: <span id="min-withdraw-amount" class="stat-value"></span> ‡¶ï‡¶Ø‡¶º‡ßá‡¶®‡•§</p>
        <div class="withdraw-form">
            <input type="number" id="withdraw-amount" placeholder="‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü">
            <select id="withdraw-method">
                <option value="Bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                <option value="Nagad">‡¶®‡¶ó‡¶¶</option>
                <option value="USDT">USDT (TRC20)</option>
            </select>
            <input type="text" id="withdraw-address" placeholder="‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂/‡¶®‡¶ó‡¶¶ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ USDT ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏">
            <button class="nav-button active" onclick="submitWithdrawal()" style="width: 100%;">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</button>
        </div>
        
        <h3 style="margin-top: 20px;">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø (TBL ‡¶è ‡¶®‡ßá‡¶á, ‡¶§‡¶æ‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨ ‡¶®‡¶æ)</h3>
    </div>

    <div id="leaderboard" class="view panel">
        <h2>üìä ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° (‡¶ü‡¶™ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤)</h2>
        <p style="color: var(--tg-theme-hint-color);">TBL ‡¶è ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶∏‡¶¨ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶®‡¶æ, ‡¶§‡¶æ‡¶á ‡¶è‡¶ü‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶ü‡¶™ ‡ß© ‡¶ú‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá (‡¶¨‡¶æ ‡¶ü‡¶ø‡¶¨‡¶ø‡¶è‡¶≤ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶æ‡¶∞‡ßá ‡¶°‡¶æ‡¶Æ‡¶ø ‡¶°‡ßá‡¶ü‡¶æ):</p>
        <table class="admin-table">
            <thead><tr><th>‡¶∞‚Äç‡ßç‡¶Ø‡¶æ‡¶ô‡ßç‡¶ï</th><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</th></tr></thead>
            <tbody>
                <tr><td>‡ßß</td><td>10101010</td><td>50</td></tr>
                <tr><td>‡ß®</td><td>20202020</td><td>35</td></tr>
                <tr><td>‡ß©</td><td><span id="lb-self-id"></span> (‡¶Ü‡¶™‡¶®‡¶ø)</td><td><span id="lb-self-refs"></span></td></tr>
            </tbody>
        </table>
    </div>

    <div id="support" class="view panel">
        <h2>üí° ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h2>
        <p>‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º ‡¶¨‡¶æ ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
        <a id="support-link" href="#" target="_blank" class="nav-button active" style="width: 100%; text-align: center;">‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a>
    </div>

    <div id="admin" class="view panel">
        <h2>üëë ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h2>
        <h3 style="color: var(--tg-theme-link-color);">‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</h3>
        <div class="withdraw-form">
            <input type="number" id="admin-ref-bonus" placeholder="‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ (‡¶ï‡¶Ø‡¶º‡ßá‡¶®)">
            <input type="number" id="admin-min-withdraw" placeholder="‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶ø‡¶Æ‡ßç‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ (‡¶ï‡¶Ø‡¶º‡ßá‡¶®)">
            <input type="number" id="admin-task1-reward" placeholder="‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡ßß ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
            <input type="number" id="admin-task2-reward" placeholder="‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡ß® ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
            <input type="text" id="admin-support-link" placeholder="‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï">
            <button class="nav-button active" onclick="updateAdminSettings()" style="width: 100%;">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
        
        <h3 style="color: var(--tg-theme-link-color); margin-top: 20px;">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</h3>
        <table class="admin-table">
            <thead>
                <tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü</th><th>‡¶Æ‡ßá‡¶•‡¶°</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏</th><th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr>
            </thead>
            <tbody id="admin-withdraw-requests">
                <tr><td colspan="6" style="text-align: center;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const BOT_URL = tg.initDataUnsafe.start_param ? `https://t.me/${tg.initDataUnsafe.start_param.split(' ')[0]}?start=` : '';
    let isAdmin = false;
    
    tg.ready();
    tg.expand();
    
    // --- UI/VIEW CONTROLS ---
    function showView(viewId) {
        document.querySelectorAll('.view').forEach(view => view.style.display = 'none');
        document.getElementById(viewId).style.display = 'block';
        document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`[onclick="showView('${viewId}')"]`).classList.add('active');

        // URL ‡¶•‡ßá‡¶ï‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≠‡¶ø‡¶â ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßá ‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        if (viewId === 'admin') {
            document.getElementById('admin-nav-btn').click();
        }
    }

    // --- DATA COMMUNICATION ---
    function sendDataToBot(action, payload = {}) {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('nav-bar').style.display = 'none';
        
        const requestPayload = JSON.stringify({ action: action, ...payload });
        tg.sendData(requestPayload);
    }
    
    tg.onEvent('mainButtonClicked', () => sendDataToBot('fetch_data'));
    
    tg.onEvent('onReceivedData', (data) => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('nav-bar').style.display = 'flex';
        
        try {
            const botData = JSON.parse(data.data);
            
            if (botData.error) {
                showAlert(botData.error, 'error');
            } else if (botData.success) {
                showAlert(botData.success, 'success');
            }

            // ‡¶°‡ßá‡¶ü‡¶æ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
            renderData(botData);

        } catch (e) {
            showAlert("‡¶¨‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶°‡ßá‡¶ü‡¶æ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§", 'error');
            console.error("Data Parse Error:", e);
        }
    });

    // --- RENDER DATA ---
    function renderData(data) {
        // --- ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶°‡ßá‡¶ü‡¶æ ---
        const userInfo = data.user_info;
        const settings = data.settings;

        document.getElementById('acc-user-id').textContent = userInfo.id;
        document.getElementById('acc-coins').textContent = userInfo.coins;
        document.getElementById('acc-referrals').textContent = userInfo.referrals;
        document.getElementById('acc-ref-link').textContent = `${BOT_URL}${userInfo.id}`;
        
        document.getElementById('lb-self-id').textContent = userInfo.id;
        document.getElementById('lb-self-refs').textContent = userInfo.referrals;

        // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
        document.getElementById('task1-status').textContent = userInfo.task_1_done ? `‚úÖ Done (Earned ${settings.task_1_reward} Coin)` : `‚ùå Pending (Reward: ${settings.task_1_reward} Coin)`;
        document.getElementById('task1-btn').style.display = userInfo.task_1_done ? 'none' : 'inline';
        
        document.getElementById('task2-status').textContent = userInfo.task_2_done ? `‚úÖ Done (Earned ${settings.task_2_reward} Coin)` : `‚ùå Pending (Requires 3 Refs, Have ${userInfo.referrals}) (Reward: ${settings.task_2_reward} Coin)`;
        document.getElementById('task2-btn').style.display = (userInfo.task_2_done || userInfo.referrals < 3) ? 'none' : 'inline';
        
        // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
        document.getElementById('min-withdraw-amount').textContent = settings.min_withdrawal;
        
        // ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï
        document.getElementById('support-link').href = settings.support_link;

        // --- ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶°‡ßá‡¶ü‡¶æ ---
        if (data.is_admin) {
            isAdmin = true;
            document.getElementById('admin-nav-btn').style.display = 'inline';
            
            // ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            document.getElementById('admin-ref-bonus').value = settings.referral_bonus;
            document.getElementById('admin-min-withdraw').value = settings.min_withdrawal;
            document.getElementById('admin-task1-reward').value = settings.task_1_reward;
            document.getElementById('admin-task2-reward').value = settings.task_2_reward;
            document.getElementById('admin-support-link').value = settings.support_link;
            
            // ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            renderWithdrawalRequests(data.admin_data.withdrawal_requests);

            // URL ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('view') === 'admin') {
                showView('admin');
            } else {
                showView('account'); // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶≠‡¶ø‡¶â 
            }
        } else {
            showView('account');
        }
    }
    
    // --- ADMIN SPECIFIC RENDERING ---
    function renderWithdrawalRequests(requests) {
        const tbody = document.getElementById('admin-withdraw-requests');
        tbody.innerHTML = '';
        
        if (requests.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á‡•§</td></tr>';
            return;
        }

        requests.forEach((req, index) => {
            const row = tbody.insertRow();
            row.insertCell().textContent = req.user_id;
            row.insertCell().textContent = req.amount;
            row.insertCell().textContent = req.method;
            row.insertCell().textContent = req.address;
            row.insertCell().textContent = req.status;
            
            const actionCell = row.insertCell();
            actionCell.innerHTML = `<button class="nav-button" style="padding: 3px 8px;" onclick="processWithdrawal(${index}, 'approve')">Approve</button>`;
        });
    }

    // --- FORM SUBMISSION HANDLERS ---
    function submitWithdrawal() {
        const amount = parseInt(document.getElementById('withdraw-amount').value);
        const method = document.getElementById('withdraw-method').value;
        const address = document.getElementById('withdraw-address').value.trim();
        const currentCoins = parseInt(document.getElementById('acc-coins').textContent);
        const minWithdrawal = parseInt(document.getElementById('min-withdraw-amount').textContent);

        if (!amount || amount < minWithdrawal || amount > currentCoins || !address) {
            showAlert(`‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü ${minWithdrawal} ‡¶è‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`, 'error');
            return;
        }
        
        sendDataToBot('submit_withdrawal', { amount: amount, method: method, address: address });
    }

    function submitTask(taskId) {
        // TBL ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡ß®-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá‡•§
        sendDataToBot('complete_task', { task_id: taskId });
    }

    function updateAdminSettings() {
        if (!isAdmin) {
            showAlert("‚ùå ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶®‡ßá‡¶á‡•§", 'error');
            return;
        }
        
        const newSettings = {
            referral_bonus: parseInt(document.getElementById('admin-ref-bonus').value) || 0,
            min_withdrawal: parseInt(document.getElementById('admin-min-withdraw').value) || 0,
            task_1_reward: parseInt(document.getElementById('admin-task1-reward').value) || 0,
            task_2_reward: parseInt(document.getElementById('admin-task2-reward').value) || 0,
            support_link: document.getElementById('admin-support-link').value.trim()
        };

        sendDataToBot('update_settings', { settings: newSettings });
    }
    
    // Admin action to approve/reject withdrawal (requires TBL update)
    function processWithdrawal(index, action) {
        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø @on_web_app_data-‡¶è ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® 'process_withdrawal' ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§
        showAlert(`Admin action for index ${index}, action ${action} sent. TBL logic required.`, 'success');
    }

    // --- UTILITIES ---
    function showAlert(message, type) {
        const statusDiv = document.getElementById('status-message');
        statusDiv.textContent = message;
        statusDiv.className = `alert ${type}`;
        statusDiv.style.display = 'block';
        setTimeout(() => statusDiv.style.display = 'none', 5000);
    }

    // Initial Data Fetch
    sendDataToBot('fetch_data');
</script>

</body>
  </html>
